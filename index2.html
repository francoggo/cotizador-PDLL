<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Paseo de las Laderas | INHAUS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #1a252f; /* Azul oscuro corporativo */
            --accent-color: #c0392b; /* Rojo/Ladrillo para resaltar precios */
            --bg-color: #f4f6f7;
            --card-bg: #ffffff;
        }
        body { 
            font-family: 'Segoe UI', Helvetica, Arial, sans-serif; 
            background-color: var(--bg-color); 
            padding: 20px; 
            color: #333; 
        }
        
        .main-container {
            max-width: 700px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        /* --- HEADER CON LOGO --- */
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            border-bottom: 2px solid #f0f0f0; 
            padding-bottom: 20px; 
        }
        .logo-img { 
            max-height: 100px; /* Ajusta esto si tu logo se ve muy grande o pequeño */
            width: auto;
            display: block;
            margin: 0 auto 15px auto;
        }
        h1 { 
            font-size: 22px; 
            margin: 0; 
            color: var(--primary-color); 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
        }
        
        /* --- SELECTORES --- */
        .control-group { margin-bottom: 20px; }
        label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: var(--primary-color); 
            font-size: 0.9rem;
        }
        select { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #dde2e5; 
            border-radius: 8px; 
            font-size: 16px; 
            background-color: #fff;
            transition: all 0.3s;
            cursor: pointer;
        }
        select:focus { 
            border-color: var(--primary-color); 
            box-shadow: 0 0 5px rgba(26, 37, 47, 0.2);
            outline: none; 
        }
        select:disabled { 
            background-color: #f8f9fa; 
            color: #aaa; 
            cursor: not-allowed;
        }

        /* --- TARJETA DE RESULTADOS --- */
        .quote-card {
            background: #fff;
            border: 1px solid #eee;
            border-left: 5px solid var(--primary-color);
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            display: none; /* Oculto hasta calcular */
        }
        .quote-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 12px; 
            border-bottom: 1px dashed #eee; 
            padding-bottom: 8px; 
        }
        .quote-row:last-child { border-bottom: none; margin-bottom: 0; }
        
        .quote-label { font-weight: 600; color: #555; }
        .quote-value { font-weight: 400; color: #000; }
        
        .total-section {
            background-color: #fdfdfd;
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #eaeaea;
        }
        .total-price { 
            font-size: 1.6em; 
            color: var(--accent-color); 
            font-weight: bold; 
        }

        /* --- BOTONES --- */
        .actions { margin-top: 30px; text-align: center; }
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 25px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            font-weight: 600;
        }
        .btn:hover { background-color: #2c3e50; }
        
        .footer-note {
            margin-top: 20px;
            font-size: 12px;
            color: #999;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="main-container" id="quote-capture">
    <div class="header">
        <img src="SSSS.jpeg" alt="INHAUS Logo" class="logo-img">
        <h1>Cotización Oficial</h1>
    </div>

    <div class="control-group hide-on-export">
        <label for="sectionSelect">1. Selecciona la Fase / Sección</label>
        <select id="sectionSelect" onchange="onSectionChange()">
            <option value="">-- Selecciona una opción --</option>
            </select>
    </div>

    <div class="control-group hide-on-export">
        <label for="loteSelect">2. Selecciona el Lote</label>
        <select id="loteSelect" onchange="renderQuote()" disabled>
            <option value="">-- Primero selecciona la Fase --</option>
        </select>
    </div>

    <div id="quoteResult" class="quote-card">
        <div class="quote-row">
            <span class="quote-label">Proyecto</span>
            <span class="quote-value">Paseo de las Laderas</span>
        </div>
        <div class="quote-row">
            <span class="quote-label">Ubicación</span>
            <span class="quote-value" id="dispSection">-</span>
        </div>
        <div class="quote-row">
            <span class="quote-label">Lote Seleccionado</span>
            <span class="quote-value" id="dispLote" style="font-weight:bold;">-</span>
        </div>
        <div class="quote-row">
            <span class="quote-label">Superficie Total</span>
            <span class="quote-value"><span id="dispArea">0</span> m²</span>
        </div>

        <div class="total-section">
            <div style="text-align: center;">
                <span style="display:block; font-size:0.9em; color:#777; margin-bottom:5px;">Precio de Contado</span>
                <span class="total-price" id="dispPrecio">$0.00</span>
                <span style="display:block; font-size:0.8em; color:#999; margin-top:5px;">Moneda Nacional (MXN)</span>
            </div>
        </div>

        <div class="footer-note">
            *Precios y disponibilidad sujetos a cambio sin previo aviso.<br>
            Cotización válida por 7 días.
        </div>
    </div>
</div>

<div class="actions">
    <button class="btn" onclick="downloadImage()">Descargar Cotización (Imagen)</button>
</div>

<script>
    /* ================================================================
       BASE DE DATOS INCRUSTADA
       [cite_start]Fuente: PDLL_sections_003_004_005_priced.xlsx - Combined_All.csv [cite: 1]
    ================================================================
    */
    const rawCsvData = `Lote,Area_m2,Section,Precio_MXN
115,125.7,3,350000
1017,123.4,3,350000
1022,118.4,3,350000
1024,126,3,350000
1026,126,3,350000
1028,126,3,350000
1030,126,3,350000
1032,126,3,350000
1034,126,3,350000
1036,126,3,350000
1038,126,3,350000
1040,126,3,350000
1042,126,3,350000
1044,126,3,350000
1046,126,3,350000
1048,126,3,350000
1050,126,3,350000
1052,126,3,350000
1054,126,3,350000
1056,126,3,350000
1058,126,3,350000
1060,126,3,350000
1062,126,3,350000
1064,126,3,350000
1066,126,3,350000
1068,126,3,350000
1070,126,3,350000
1072,126,3,350000
1074,126,3,350000
1076,141.5,3,350000
171,183.92,4,350000
1046,126,4,350000
1047,126,4,350000
1048,126,4,350000
1049,126,4,350000
1050,126,4,350000
1051,126,4,350000
1052,126,4,350000
1053,126,4,350000
1054,126,4,350000
1055,126,4,350000
1056,126,4,350000
1057,126,4,350000
1058,126,4,350000
1059,126,4,350000
1060,126,4,350000
1061,126,4,350000
1062,126,4,350000
1063,126,4,350000
1064,126,4,350000
1065,126,4,350000
1066,126,4,350000
1067,126,4,350000
1068,126,4,350000
1069,126,4,350000
1170,176.74,4,350000
1023,135.32,5,350000
1025,126,5,350000
1026,126,5,350000
1027,126,5,350000
1028,126,5,350000
1029,126,5,350000
1030,126,5,350000
1031,126,5,350000
1032,126,5,350000
1033,126,5,350000
1034,126,5,350000
1035,126,5,350000
1036,126,5,350000
1037,126,5,350000
1038,126,5,350000
1039,126,5,350000
1040,126,5,350000
1041,126,5,350000
1042,126,5,350000
1043,126,5,350000
1044,126,5,350000
1045,126,5,350000
1116,123.6,5,350000
1118,110.85,5,350000
1120,139.37,5,350000
1122,125.33,5,350000
1124,110.85,5,350000`;

    let database = [];

    // 1. Procesamiento de la Base de Datos
    function initDatabase() {
        const lines = rawCsvData.trim().split('\n');
        // Detectar si hay encabezado y saltarlo
        const startRow = lines[0].toLowerCase().includes('lote') ? 1 : 0;

        for (let i = startRow; i < lines.length; i++) {
            const col = lines[i].split(',');
            if (col.length >= 4) {
                // Mapeo: Lote[0], Area[1], Section[2], Precio[3]
                database.push({
                    lote: col[0].trim(),
                    area: parseFloat(col[1]),
                    section: col[2].trim(),
                    precio: parseFloat(col[3])
                });
            }
        }
        populateSections();
    }

    // 2. Llenar Selector de Secciones (Fases)
    function populateSections() {
        // Obtener lista única de secciones
        const sections = [...new Set(database.map(d => d.section))];
        // Ordenar (ej. 3, 4, 5)
        sections.sort((a, b) => parseInt(a) - parseInt(b));

        const select = document.getElementById('sectionSelect');
        sections.forEach(sec => {
            const opt = document.createElement('option');
            opt.value = sec;
            opt.text = `Sección ${sec}`;
            select.appendChild(opt);
        });
    }

    // 3. Actualizar Lotes al cambiar Sección
    function onSectionChange() {
        const secVal = document.getElementById('sectionSelect').value;
        const loteSelect = document.getElementById('loteSelect');

        // Limpiar dropdown de lotes
        loteSelect.innerHTML = '<option value="">-- Selecciona el Lote --</option>';
        loteSelect.disabled = (secVal === "");
        
        if (!secVal) { 
            document.getElementById('quoteResult').style.display = 'none';
            return; 
        }

        // Filtrar lotes de la sección elegida
        const filtered = database.filter(d => d.section === secVal);
        
        // Ordenar lotes lógicamente (Numérico)
        filtered.sort((a, b) => {
            const numA = parseFloat(a.lote);
            const numB = parseFloat(b.lote);
            if (!isNaN(numA) && !isNaN(numB)) return numA - numB;
            return a.lote.localeCompare(b.lote);
        });

        filtered.forEach(item => {
            const opt = document.createElement('option');
            opt.value = item.lote;
            opt.text = `Lote ${item.lote}`;
            // Guardar datos en el elemento HTML para acceso rápido
            opt.dataset.area = item.area;
            opt.dataset.precio = item.precio;
            loteSelect.appendChild(opt);
        });
    }

    // 4. Calcular y Mostrar Cotización
    function renderQuote() {
        const loteSelect = document.getElementById('loteSelect');
        const resultBox = document.getElementById('quoteResult');

        if (!loteSelect.value) {
            resultBox.style.display = 'none';
            return;
        }

        // Recuperar datos
        const sectionTxt = document.getElementById('sectionSelect').options[document.getElementById('sectionSelect').selectedIndex].text;
        const loteTxt = loteSelect.value;
        const areaVal = loteSelect.options[loteSelect.selectedIndex].dataset.area;
        const precioVal = loteSelect.options[loteSelect.selectedIndex].dataset.precio;

        // Inyectar en HTML
        document.getElementById('dispSection').innerText = sectionTxt;
        document.getElementById('dispLote').innerText = loteTxt;
        document.getElementById('dispArea').innerText = areaVal;

        // Formatear Dinero
        const precioFmt = new Intl.NumberFormat('es-MX', {
            style: 'currency',
            currency: 'MXN',
            minimumFractionDigits: 0
        }).format(precioVal);

        document.getElementById('dispPrecio').innerText = precioFmt;

        // Mostrar tarjeta con animación suave
        resultBox.style.display = 'block';
        resultBox.scrollIntoView({ behavior: 'smooth' });
    }

    // 5. Descargar Imagen
    function downloadImage() {
        const captureElement = document.getElementById('quote-capture');
        const controls = document.querySelectorAll('.hide-on-export');
        const btn = document.querySelector('.actions');
        
        // Ocultar temporalmente controles y botones
        controls.forEach(c => c.style.display = 'none');
        btn.style.display = 'none';

        html2canvas(captureElement, { 
            scale: 2, // Alta resolución
            backgroundColor: "#ffffff" // Asegurar fondo blanco
        }).then(canvas => {
            // Crear enlace de descarga
            const link = document.createElement('a');
            const lote = document.getElementById('loteSelect').value;
            link.download = `Cotizacion_PDLL_Lote_${lote}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();

            // Restaurar visibilidad
            controls.forEach(c => c.style.display = 'block');
            btn.style.display = 'block';
        });
    }

    // Iniciar app
    window.onload = initDatabase;
</script>

</body>
</html>
